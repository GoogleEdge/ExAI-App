# ExAI åç«¯ API è§„èŒƒæ–‡æ¡£

ç‰ˆæœ¬ï¼šv1.0
æ›´æ–°æ—¥æœŸï¼š2026-01-02  

---
## ğŸ“š ç›®å½•
- [1. åŸºæœ¬ä¿¡æ¯](#1-åŸºæœ¬ä¿¡æ¯)
- [2. ç»Ÿä¸€å“åº”æ ¼å¼](#2-ç»Ÿä¸€å“åº”æ ¼å¼)
- [3. æ ¸å¿ƒæ¥å£](#3-æ ¸å¿ƒæ¥å£)
- [4. æŸ¥è¯¢æ¥å£](#4-æŸ¥è¯¢æ¥å£)
- [5. æ‰©å±•æ¥å£](#5-æ‰©å±•æ¥å£)
- [6. æ€§èƒ½ä¼˜åŒ–æŒ‡å—](#6-æ€§èƒ½ä¼˜åŒ–æŒ‡å—)
- [7. é”™è¯¯ç å®šä¹‰](#7-é”™è¯¯ç å®šä¹‰)
---
## 1. åŸºæœ¬ä¿¡æ¯
### 1.1 Base URL
```
å¼€å‘ç¯å¢ƒ: http://localhost:8000/api/v1
ç”Ÿäº§ç¯å¢ƒ: æœªé…ç½®
```
### 1.2 è®¤è¯æ–¹å¼
å½“å‰ç‰ˆæœ¬æš‚æ— éœ€è®¤è¯ï¼ˆä½¿ç”¨é»˜è®¤ç”¨æˆ· IDï¼‰ã€‚
åç»­ç‰ˆæœ¬å°†æ”¯æŒ API Key è®¤è¯ï¼š
```
Authorization: Bearer YOUR_API_KEY
```
### 1.3 è¯·æ±‚æ ¼å¼
- Content-Type: `application/json` (æ™®é€šè¯·æ±‚)
- Content-Type: `multipart/form-data` (æ–‡ä»¶ä¸Šä¼ )
### 1.4 å“åº”æ ¼å¼
æ‰€æœ‰æ¥å£è¿”å› JSON æ ¼å¼ï¼Œç»Ÿä¸€ç»“æ„è§ [2. ç»Ÿä¸€å“åº”æ ¼å¼](#2-ç»Ÿä¸€å“åº”æ ¼å¼)ã€‚
---
## 2. ç»Ÿä¸€å“åº”æ ¼å¼
### 2.1 æˆåŠŸå“åº”
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“æ•°æ®
  },
  "timestamp": "2026-01-02T10:30:00Z"
}
```
### 2.2 å¤±è´¥å“åº”
```json
{
  "code": 400,
  "msg": "å‚æ•°é”™è¯¯ï¼šç¼ºå°‘å¿…å¡«å­—æ®µ subject",
  "data": null,
  "timestamp": "2026-01-02T10:30:00Z"
}
```
### 2.3 åˆ†é¡µå“åº”
```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 20,
    "items": [
      // æ•°æ®é¡¹åˆ—è¡¨
    ]
  },
  "timestamp": "2026-01-02T10:30:00Z"
}
```
---
## 3. æ ¸å¿ƒæ¥å£
### 3.1 æäº¤è¯•å·åˆ†æ
#### æ¥å£æè¿°
ä¸Šä¼ è¯•å·/ç­”é¢˜å¡å›¾ç‰‡ï¼Œè¿›è¡Œ AI åˆ†æï¼Œè¿”å›è–„å¼±ç‚¹ã€å­¦ä¹ å»ºè®®ç­‰ã€‚
#### è¯·æ±‚ä¿¡æ¯
- **URL**: `POST /api/v1/analyzes/exam`
- **Content-Type**: `multipart/form-data`
#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | æ˜¯ | è¯•å·æˆ–ç­”é¢˜å¡å›¾ç‰‡ï¼Œæ”¯æŒ jpg/pngï¼Œæœ€å¤§ 100MB |
| subject | string | æ˜¯ | ç§‘ç›®åç§°ï¼Œå¦‚ "æ•°å­¦"ã€"ç‰©ç†" |
| total_score | number | æ˜¯ | è¯•å·æ»¡åˆ†ï¼Œå¦‚ 100ã€150 |
| exam_date | string | å¦ | è€ƒè¯•æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DDï¼Œé»˜è®¤å½“å¤© |
| user_id | string | å¦ | ç”¨æˆ· IDï¼Œé»˜è®¤å†™ "default" |
#### è¯·æ±‚ç¤ºä¾‹
```bash
curl -X POST "http://localhost:8000/api/v1/analyzes/exam" \
  -F "file=@exam.jpg" \
  -F "subject=æ•°å­¦" \
  -F "total_score=100" \
  -F "exam_date=2026-01-02" \
  -F "user_id=default"
```
#### å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰
```json
{
  "code": 200,
  "msg": "åˆ†æå®Œæˆ",
  "data": {
    "analyze_id": "ana_20260102_001",
    "user_score": 82,
    "score_rate": 0.82,  //å¾—åˆ†ç‡
    "exam_date": "2026-01-02",
    "subject": "æ•°å­¦",
    "total_score": 100,
    "weak_points": [
      {
        "knowledge_id": "kp_math_001",
        "name": "å‡½æ•°çš„å•è°ƒæ€§",
        "error_count": 3,
        "weakness_level": 0.9
      },
      {
        "knowledge_id": "kp_math_002",
        "name": "å¯¼æ•°åº”ç”¨",
        "error_count": 2,
        "weakness_level": 0.7
      }
    ],
    "suggestions": [
      {
        "target_knowledge_id": "kp_math_001",
        "goal": "æŒæ¡å•è°ƒæ€§åˆ¤å®šæ–¹æ³•å’Œå¸¸è§å‡½æ•°çš„å•è°ƒåŒºé—´",
        "steps": [
          "å¤ä¹ æ•™æç¬¬3ç« 3.2èŠ‚",
          "å®Œæˆè¯¾åä¹ é¢˜3.2-1åˆ°3.2-10",
          "åš5é“ä¸“é¡¹é€‰æ‹©é¢˜å’Œ2é“è¯æ˜é¢˜"
        ],
        "textbook_refs": ["æ•™æ ç¬¬3ç«  3.2èŠ‚"],
        "estimated_minutes": 60
      }
    ],
    "chart_data": {
      "labels": ["2025-12-01", "2025-12-15", "2025-12-25", "2026-01-02"],
      "scores": [70, 75, 78, 82],
      "rates": [0.70, 0.75, 0.78, 0.82]
    },
    "created_at": "2026-01-02T10:30:00Z"
  },
  "timestamp": "2026-01-02T10:30:05Z"
}
```
#### å“åº”ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰
```json
{
  "code": 400,
  "msg": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä¸Šä¼  jpg æˆ– png",
  "data": null,
  "timestamp": "2026-01-02T10:30:00Z"
}
```
---
## 4. æŸ¥è¯¢æ¥å£
### 4.1 æŸ¥è¯¢å†å²åˆ†æåˆ—è¡¨
#### æ¥å£æè¿°
æŸ¥è¯¢ç”¨æˆ·çš„è€ƒè¯•åˆ†æå†å²è®°å½•ã€‚
#### è¯·æ±‚ä¿¡æ¯
- **URL**: `GET /api/v1/analyzes`
#### æŸ¥è¯¢å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| subject | string | å¦ | ç§‘ç›®ç­›é€‰ï¼Œä¸ä¼ åˆ™æŸ¥æ‰€æœ‰ç§‘ç›® |
| user_id | string | å¦ | ç”¨æˆ· IDï¼Œé»˜è®¤ "default" |
| limit | int | å¦ | è¿”å›æ¡æ•°ï¼Œåˆ°æ—¶å€™å†çœ‹ |
| offset | int | å¦ | åç§»é‡ï¼Œç”¨äºåˆ†é¡µï¼Œé»˜è®¤ 0 |
#### è¯·æ±‚ç¤ºä¾‹
```bash
curl "http://localhost:8000/api/v1/analyzes?subject=æ•°å­¦&limit=10"
```
#### å“åº”ç¤ºä¾‹
```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "total": 12,
    "limit": 10,
    "offset": 0,
    "items": [
      {
        "analyze_id": "ana_20260102_001",
        "subject": "æ•°å­¦",
        "exam_date": "2026-01-02",
        "total_score": 100,
        "user_score": 82,
        "score_rate": 0.82,
        "created_at": "2026-01-02T10:30:00Z"
      },
      {
        "analyze_id": "ana_20251225_001",
        "subject": "æ•°å­¦",
        "exam_date": "2025-12-25",
        "total_score": 100,
        "user_score": 78,
        "score_rate": 0.78,
        "created_at": "2025-12-25T15:20:00Z"
      }
    ]
  },
  "timestamp": "2026-01-02T10:35:00Z"
}
```
### 4.2 æŸ¥è¯¢å•æ¡åˆ†æè¯¦æƒ…
#### æ¥å£æè¿°
æŸ¥è¯¢æŸæ¬¡åˆ†æçš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ã€‚
#### è¯·æ±‚ä¿¡æ¯
- **URL**: `GET /api/v1/analyzes/{analyze_id}`
#### è·¯å¾„å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| analyze_id | string | æ˜¯ | åˆ†æ ID |
#### è¯·æ±‚ç¤ºä¾‹
```bash
curl "http://localhost:8000/api/v1/analyzes/ana_20260102_001"
```
#### å“åº”ç¤ºä¾‹
å“åº”ç»“æ„ä¸ [3.1 æäº¤è¯•å·åˆ†æ](#31-æäº¤è¯•å·åˆ†æ) çš„ `data` å­—æ®µä¸€è‡´ã€‚
### 4.3 æŸ¥è¯¢æˆç»©è¶‹åŠ¿
#### æ¥å£æè¿°
æŸ¥è¯¢ç”¨æˆ·çš„æˆç»©è¶‹åŠ¿æ•°æ®ï¼Œç”¨äºç»˜åˆ¶æŠ˜çº¿å›¾ã€‚
#### è¯·æ±‚ä¿¡æ¯
- **URL**: `GET /api/v1/stats/trend`
#### æŸ¥è¯¢å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| subject | string | å¦ | ç§‘ç›®ï¼Œä¸ä¼ åˆ™è¿”å›æ•´ä½“è¶‹åŠ¿ |
| user_id | string | å¦ | ç”¨æˆ· IDï¼Œé»˜è®¤ "default" |
| days | int | å¦ | æœ€è¿‘å¤šå°‘å¤©ï¼Œé»˜è®¤ 60 |
#### è¯·æ±‚ç¤ºä¾‹
```bash
curl "http://localhost:8000/api/v1/stats/trend?subject=æ•°å­¦&days=60"
```
#### å“åº”ç¤ºä¾‹
```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "subject": "æ•°å­¦",
    "points": [
      {
        "date": "2025-12-01",
        "score": 70,
        "total": 100,
        "rate": 0.70
      },
      {
        "date": "2025-12-15",
        "score": 75,
        "total": 100,
        "rate": 0.75
      },
      {
        "date": "2026-01-02",
        "score": 82,
        "total": 100,
        "rate": 0.82
      }
    ]
  },
  "timestamp": "2026-01-02T10:35:00Z"
}
```
---
## 5. æ‰©å±•æ¥å£ï¼ˆæš‚æ—¶ä¸ç”¨ï¼‰
### 5.1 é”™é¢˜æœ¬ç®¡ç†
#### 5.1.1 æ·»åŠ é”™é¢˜
- **URL**: `POST /api/v1/errors`
- **Content-Type**: `application/json`
è¯·æ±‚å‚æ•°ï¼š
```json
{
  "analyze_id": "ana_20260102_001",
  "question_seq": 5,
  "user_id": "default"
}
```
#### 5.1.2 æŸ¥è¯¢é”™é¢˜åˆ—è¡¨
- **URL**: `GET /api/v1/errors`
æŸ¥è¯¢å‚æ•°ï¼š`subject`, `status` (0:æœªå¤ä¹ , 1:å¾…å¤ä¹ , 2:å·²æŒæ¡), `limit`
#### 5.1.3 æ›´æ–°é”™é¢˜çŠ¶æ€
- **URL**: `PATCH /api/v1/errors/{error_id}`
è¯·æ±‚å‚æ•°ï¼š
```json
{
  "status": 2,
  "review_count": 1
}
```
### 5.2 RAG æ£€ç´¢
#### 5.2.1 çŸ¥è¯†ç‚¹æ£€ç´¢
- **URL**: `POST /api/v1/rag/search`
- **Content-Type**: `application/json`
è¯·æ±‚å‚æ•°ï¼š
```json
{
  "query": "å‡½æ•°å•è°ƒæ€§çš„å¸¸è§é”™è¯¯",
  "top_k": 5
}
```
å“åº”ç¤ºä¾‹ï¼š
```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "results": [
      {
        "content": "å‡½æ•°å•è°ƒæ€§æ˜¯å¯¼æ•°åº”ç”¨çš„åŸºç¡€...",
        "source": "æ•™æ ç¬¬3ç«  3.2èŠ‚",
        "score": 0.92
      }
    ]
  }
}
```
### 5.3 çŸ¥è¯†åº“ç®¡ç†ï¼ˆæš‚æ—¶ä¸ç”¨ï¼‰
#### 5.3.1 ä¸Šä¼ æ–‡æ¡£åˆ°çŸ¥è¯†åº“
- **URL**: `POST /api/v1/knowledge/documents`
- **Content-Type**: `multipart/form-data`
è¯·æ±‚å‚æ•°ï¼š
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | æ˜¯ | PDF æ–‡æ¡£ |
| subject | string | æ˜¯ | ç§‘ç›® |
| doc_type | string | å¦ | æ–‡æ¡£ç±»å‹ï¼štextbook/note/question |
#### 5.3.2 æŸ¥è¯¢çŸ¥è¯†åº“æ–‡æ¡£
- **URL**: `GET /api/v1/knowledge/documents`
#### 5.3.3 åˆ é™¤æ–‡æ¡£
- **URL**: `DELETE /api/v1/knowledge/documents/{doc_id}`
---
## 6. æ€§èƒ½ä¼˜åŒ–æŒ‡å—
### 6.1 æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–
1. **é™åˆ¶æ–‡ä»¶å¤§å°**
   - æœ€å¤§ 10MB
   - å‰ç«¯å‹ç¼©å›¾ç‰‡åå†ä¸Šä¼ 
2. **å¼‚æ­¥å¤„ç†**
   - ä½¿ç”¨ FastAPI çš„ `BackgroundTasks` å¤„ç†è€—æ—¶æ“ä½œ
   - ç«‹å³è¿”å›ä»»åŠ¡ IDï¼Œå‰ç«¯è½®è¯¢æŸ¥è¯¢ç»“æœ
### 6.2 å“åº”ç¼“å­˜
1. **å†å²åˆ†æç¼“å­˜**
   - ä½¿ç”¨ Redis ç¼“å­˜å†å²åˆ†æåˆ—è¡¨
   - ç¼“å­˜æ—¶é—´ï¼š5 åˆ†é’Ÿ
2. **æˆç»©è¶‹åŠ¿ç¼“å­˜**
   - æŸ¥è¯¢ç»“æœç¼“å­˜ 10 åˆ†é’Ÿ
   - ç”¨æˆ·æäº¤æ–°åˆ†æåæ¸…é™¤ç¼“å­˜
## 7. é”™è¯¯ç å®šä¹‰
| é”™è¯¯ç  | è¯´æ˜ | HTTP çŠ¶æ€ç  |
|--------|------|------------|
| 200 | æˆåŠŸ | 200 |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | 400 |
| 401 | æœªè®¤è¯ | 401 |
| 403 | æ— æƒé™ | 403 |
| 404 | èµ„æºä¸å­˜åœ¨ | 404 |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | 429 |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | 500 |
| 503 | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ | 503 |
| 1001 | æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ | 400 |
| 1002 | æ–‡ä»¶å¤§å°è¶…é™ | 400 |
| 1003 | OCR è¯†åˆ«å¤±è´¥ | 500 |
| 1004 | AI åˆ†æå¤±è´¥ | 500 |
| 1005 | RAG æ£€ç´¢å¤±è´¥ | 500 |
| 2001 | åˆ†æè®°å½•ä¸å­˜åœ¨ | 404 |
| 2002 | é”™é¢˜è®°å½•ä¸å­˜åœ¨ | 404 |
---
**æ–‡æ¡£ç»“æŸ**
